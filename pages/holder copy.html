<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Defense Attorney Modal</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Google-style dropdown */
    .search-suggestions {
      border: 1px solid #ccc;
      border-top: none;
      max-height: 200px;
      overflow-y: auto;
      position: absolute;
      z-index: 1000;
      background-color: white;
      width: 100%;
      margin-bottom: 3rem;
      /* <-- Add this */
    }


    .search-suggestions div {
      padding: 10px;
      cursor: pointer;
    }

    .search-suggestions div:hover {
      background-color: #f0f0f0;
    }

    #searchContainer {
      position: relative;
    }
  </style>
</head>

<body>

  <!-- Trigger Button -->
  <button type="button" class="btn btn-primary m-3" data-bs-toggle="modal" data-bs-target="#attorneyModal">
    Add New Defense Attorney
  </button>

  <!-- Modal -->
  <div class="modal fade" id="attorneyModal" tabindex="-1" aria-labelledby="attorneyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add New Defense Attorney</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">

          <p>To add a New Defense Attorney, use the search box or enter the data manually</p>

          <!-- Search Input -->
          <div class="mb-3" id="searchContainer">
            <input type="search" id="searchInput" class="form-control"
              placeholder="Search by Attorney's Name or Phone Number">
            <div id="searchResults" class="search-suggestions d-none"></div>
          </div>


          <!-- Highlighted Checkbox -->
          <div id="checkboxWrapper" class="alert alert-warning d-flex align-items-center gap-2 mb-3">
            <input class="form-check-input me-2" type="checkbox" id="enableFormCheckbox" disabled>
            <label class="form-check-label fw-bold" for="enableFormCheckbox">
              No match found? Enable manual entry to add a new defense attorney.
            </label>
          </div>

          <!-- Attorney Form -->
          <form id="attorneyForm">
            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label">Attorney Type</label>
                <select class="form-select" disabled>
                  <option selected>Defence</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">Name</label>
                <input type="text" class="form-control" id="fieldName" disabled>
              </div>
              <div class="col-md-4">
                <label class="form-label">Firm</label>
                <input type="text" class="form-control" id="fieldFirm" disabled>
              </div>
              <div class="col-md-4">
                <label class="form-label">Address Type</label>
                <select class="form-select" disabled>
                  <option selected>Business</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">Address 1</label>
                <input type="text" class="form-control" id="fieldAddress1" disabled>
              </div>
              <div class="col-md-4">
                <label class="form-label">Address 2</label>
                <input type="text" class="form-control" id="fieldAddress2" disabled>
              </div>
              <div class="col-md-4">
                <label class="form-label">City</label>
                <input type="text" class="form-control" id="fieldCity" disabled>
              </div>
              <div class="col-md-2">
                <label class="form-label">State</label>
                <select class="form-select" id="fieldState" disabled>
                  <option selected>NY</option>
                </select>
              </div>
              <div class="col-md-2">
                <label class="form-label">Zip Code</label>
                <input type="text" class="form-control" id="fieldZip" disabled>
              </div>
              <div class="col-md-4">
                <label class="form-label">Phone</label>
                <input type="tel" class="form-control" id="fieldPhone" disabled>
              </div>
              <div class="col-md-4">
                <label class="form-label">Fax</label>
                <input type="tel" class="form-control" id="fieldFax" disabled>
              </div>
              <div class="col-md-4">
                <label class="form-label">Email</label>
                <input type="email" class="form-control" id="fieldEmail" disabled>
              </div>
            </div>
          </form>

        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary">Add New Defense Attorney</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Sample data
    const attorneys = [
      {
        name: "John Smith", phone: "123-456-7890", firm: "Smith Law", address1: "123 Main St",
        address2: "Suite 100", city: "New York", state: "NY", zip: "10001", fax: "123-111-1111", email: "john@smithlaw.com"
      },
      {
        name: "Jane Doe", phone: "987-654-3210", firm: "Doe & Co", address1: "456 Broadway",
        address2: "", city: "Brooklyn", state: "NY", zip: "11201", fax: "987-111-2222", email: "jane@doelaw.com"
      },
      // Add more sample records as needed...
    ];

    // Elements
    const searchInput = document.getElementById("searchInput");
    const searchResults = document.getElementById("searchResults");
    const checkbox = document.getElementById("enableFormCheckbox");
    const form = document.getElementById("attorneyForm");

    const fields = {
      name: document.getElementById("fieldName"),
      firm: document.getElementById("fieldFirm"),
      address1: document.getElementById("fieldAddress1"),
      address2: document.getElementById("fieldAddress2"),
      city: document.getElementById("fieldCity"),
      state: document.getElementById("fieldState"),
      zip: document.getElementById("fieldZip"),
      phone: document.getElementById("fieldPhone"),
      fax: document.getElementById("fieldFax"),
      email: document.getElementById("fieldEmail"),
    };

    // Enable/Disable form fields and clear them if needed
    checkbox.addEventListener("change", () => {
      const enable = checkbox.checked;

      Object.values(fields).forEach(field => {
        field.disabled = !enable;
        if (!enable) field.value = "";  // Clear field if unchecked
      });
    });

    // Handle search input
    searchInput.addEventListener("input", function () {
      const query = this.value.trim().toLowerCase();
      searchResults.innerHTML = "";
      searchResults.classList.add("d-none");

      if (query === "") {
        // Clear form and disable everything
        checkbox.disabled = true;
        checkbox.checked = false;
        checkbox.dispatchEvent(new Event("change"));
        return;
      }

      const matches = attorneys.filter(a =>
        a.name.toLowerCase().includes(query) || a.phone.includes(query)
      );

      if (matches.length > 0) {
        // Matches found — disable checkbox and populate dropdown
        checkbox.checked = false;
        checkbox.disabled = true;
        checkbox.dispatchEvent(new Event("change"));

        searchResults.classList.remove("d-none");

        matches.forEach(attorney => {
          const div = document.createElement("div");
          div.textContent = `${attorney.name} - ${attorney.phone}`;
          div.classList.add("border-bottom", "px-3", "py-2");
          div.style.cursor = "pointer";

          div.addEventListener("click", () => {
            populateForm(attorney);
            searchResults.classList.add("d-none");
          });

          searchResults.appendChild(div);
        });
      } else {
        // No matches — show message, enable checkbox
        searchResults.classList.remove("d-none");
        searchResults.innerHTML = "<div class='text-danger px-3 py-2'>No record found</div>";

        checkbox.disabled = false;
        checkbox.checked = false;
        checkbox.dispatchEvent(new Event("change"));
      }
    });

    // Hide suggestions when search input loses focus
    searchInput.addEventListener("blur", () => {
      setTimeout(() => {
        searchResults.classList.add("d-none");
      }, 200); // slight delay to allow clicking on results
    });


    // Fill form with selected attorney and disable fields
    function populateForm(data) {
      fields.name.value = data.name;
      fields.firm.value = data.firm;
      fields.address1.value = data.address1;
      fields.address2.value = data.address2;
      fields.city.value = data.city;
      fields.state.value = data.state;
      fields.zip.value = data.zip;
      fields.phone.value = data.phone;
      fields.fax.value = data.fax;
      fields.email.value = data.email;

      Object.values(fields).forEach(field => field.disabled = true);
      checkbox.disabled = true;
      checkbox.checked = false;
    }
  </script>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>