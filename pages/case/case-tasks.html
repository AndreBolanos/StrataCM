<style>
    /* Light gray background for entire nav-pills row */
    .nav-pills {
        background-color: #f8f9fa;
        /* light gray */
        padding: 0.5rem;
        border-radius: 0rem;
    }

    /* Make nav links look like tabs */
    .nav-pills .nav-link {
        color: #333;
        background-color: transparent;
        border-radius: 0rem;
        transition: background-color 0.2s ease;
    }

    /* Active tab with gray background */
    .nav-pills .nav-link.active {
        background-color: #ced4da;
        /* medium-light gray */
        color: #000;
        font-weight: 500;
    }

    /* Optional: hover effect */
    .nav-pills .nav-link:hover {
        background-color: #e2e6ea;
    }

    .form-label {
        margin-bottom: 0.2rem;
    }

    table.dataTable thead th {
        white-space: nowrap;
        /* keep headers in one line */
        text-overflow: ellipsis;
        overflow: hidden;
    }

    .table-responsive {
        overflow-x: auto;
        /* Bootstrap handles horizontal scroll */
    }

    /* Keep header visible while scrolling vertically */
    .table thead th {
        position: sticky;
        top: 0;
        z-index: 2;
        background-color: #f8f9fa;
        /* Matches Bootstrap .table-light */
    }

    /* Optional: improve scrollbar look */
    .table-responsive::-webkit-scrollbar {
        height: 8px;
        width: 8px;
    }

    .table-responsive::-webkit-scrollbar-thumb {
        background-color: rgba(0, 0, 0, 0.2);
        border-radius: 4px;
    }
</style>

<div class="header-bar d-flex justify-content-between align-items-center px-3 py-2">
    <!-- Left: Claim Number -->
    <div class="d-flex align-items-center">
        <strong class="me-2">Claim Number:</strong>
        <span id="claimNumber"></span>
    </div>

    <!-- Center: Claimant Info -->
    <div class="d-flex gap-4 text-center align-items-center">
        <div><strong>Claimant Name:</strong> MICHAEL GAST</div>
        <div><strong>Dispute:</strong> No</div>
        <div><strong>State:</strong> IL</div>
    </div>

    <!-- Right: Buttons -->
    <div class="d-flex gap-2 justify-content-center me-2">
        <button class="btn btn-sm btn-success d-flex align-items-center justify-content-center" id="saveBtn"
            style="width: 100px;">
            <i class="bi bi-floppy2-fill me-2"></i> Save
        </button>
        <button class="btn btn-sm btn-secondary d-flex align-items-center justify-content-center" data-bs-toggle="modal"
            data-bs-target="#exitModal" style="width: 100px;">
            <i class="bi bi-box-arrow-right me-2"></i> Exit
        </button>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5>Tasks</h5>
            <button class="btn btn-sm btn-primary" style="width: 100px;">+ New Task</button>
        </div>
        <hr>

        <!-- Filters -->
        <form class="filter-section mb-3">
            <div class="row gx-2 gy-2">
                <div class="col-md-3">
                    <label class="form-label form-label-sm">Task Type</label>
                    <select class="form-select form-select-sm">
                        <option selected>Select task type(s)</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label form-label-sm">Task Status</label>
                    <select class="form-select form-select-sm">
                        <option selected>Select status(es)</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label form-label-sm">Task Priority</label>
                    <select class="form-select form-select-sm">
                        <option selected>Select priority</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label form-label-sm">Assigned To</label>
                    <select class="form-select form-select-sm">
                        <option selected>Search and select nurse(s)</option>
                    </select>
                </div>

                <div class="col-md-3">
                    <label class="form-label form-label-sm">Due Date From</label>
                    <input type="date" class="form-control form-control-sm">
                </div>
                <div class="col-md-3">
                    <label class="form-label form-label-sm">Due Date To</label>
                    <input type="date" class="form-control form-control-sm">
                </div>
                <div class="col-md-3">
                    <label class="form-label form-label-sm">Created Date From</label>
                    <input type="date" class="form-control form-control-sm">
                </div>
                <div class="col-md-3">
                    <label class="form-label form-label-sm">Created Date To</label>
                    <input type="date" class="form-control form-control-sm">
                </div>

                <div class="col-md-3">
                    <label class="form-label form-label-sm">Task ID</label>
                    <input type="text" class="form-control form-control-sm" placeholder="Enter task Id">
                </div>
            </div>

            <div class="d-flex justify-content-center gap-2 mt-3">
                <button type="submit" class="btn btn-sm btn-primary" style="width: 100px;">Search</button>
                <button type="reset" class="btn btn-sm btn-outline-primary" style="width: 100px;">Reset</button>
            </div>
        </form>


        <!-- Table -->
        <div class="table-responsive mb-2" style="max-height: 50vh; overflow-y: auto;">
            <table id="taskListTable" class="table table-hover align-middle mb-0 task-table">
                <thead class="table-light sticky-top">
                    <tr>
                        <th>Task ID</th>
                        <th>Task Type</th>
                        <th>Assigned To</th>
                        <th>Task Status</th>
                        <th>Task Priority</th>
                        <th>Due Date</th>
                        <th>Created By</th>
                        <th>Created Date</th>
                        <th>Modified By</th>
                        <th>Modified Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>

                </tbody>
            </table>
        </div>

        <!-- Task Details -->
        <div class="task-details mt-2">
            <label class="form-label">Task Details</label>
            <textarea class="form-control" rows="4" placeholder="Task details will appear here"></textarea>
        </div>
    </div>
</div>

<script>
    fetchClaimNumber();
    loadTableMainTaskList();
</script>

<!-- ✅ New Task Modal -->
<div class="modal fade" id="newTaskModal" tabindex="-1" aria-labelledby="newTaskLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header text-white" style="background-color: #214563;">
                <h5 class="modal-title" id="newTaskLabel">New Task</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">
                <form id="newTaskForm">
                    <div class="row g-3">

                        <!-- Task Created Date -->
                        <div class="col-md-6">
                            <label class="form-label">Task Created Date</label>
                            <input type="text" class="form-control" value="07/31/2025" disabled>
                        </div>

                        <div class="col-md-6"></div>

                        <!-- Task Type -->
                        <div class="col-md-6">
                            <label class="form-label">Task Type</label>
                            <select class="form-select mandatoryINP">
                                <option selected disabled>Select task type</option>
                                <option>Follow-up</option>
                                <option>Appointment</option>
                                <option>Call</option>
                            </select>
                        </div>

                        <!-- Task Status -->
                        <div class="col-md-6">
                            <label class="form-label">Task Status</label>
                            <select class="form-select mandatoryINP">
                                <option selected disabled>Select status</option>
                                <option>In Progress</option>
                                <option>Completed</option>
                                <option>Pending</option>
                            </select>
                        </div>

                        <!-- Priority -->
                        <div class="col-md-6">
                            <label class="form-label">Priority</label>
                            <select class="form-select mandatoryINP">
                                <option selected disabled>Select priority</option>
                                <option>Low</option>
                                <option>Routine</option>
                                <option>High</option>
                            </select>
                        </div>

                        <!-- Task Due Date -->
                        <div class="col-md-6">
                            <label class="form-label">Task Due Date</label>
                            <input type="datetime-local" class="form-control mandatoryINP">
                        </div>

                        <!-- Assigned To Nurse -->
                        <div class="col-md-6">
                            <label class="form-label">Assigned to Nurse</label>
                            <select class="form-select mandatoryINP">
                                <option selected>John Davies</option>
                                <option>Laura Smith</option>
                                <option>Emily Carter</option>
                            </select>
                        </div>

                        <!-- Assigned to MSS Group -->
                        <div class="col-md-6 d-flex" style="align-items: center;">
                            <div class="form-check pt-2">
                                <input class="form-check-input me-2" type="checkbox" id="assignedToMSS">
                                <label class="form-check-label" for="assignedToMSS">Assigned To MSS Group</label>
                            </div>
                        </div>


                        <!-- Comments -->
                        <div class="col-12 mt-2">
                            <label class="form-label">Comments</label>
                            <textarea class="form-control" rows="4"></textarea>
                        </div>

                    </div>
                </form>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer justify-content-center">
                <button type="button" id="saveTaskBtn" class="btn btn-primary px-4">Save</button>
                <button type="button" class="btn btn-outline-primary px-4" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<!-- ✅ Style for mandatory fields -->
<style>
    .mandatoryINP {
        border-left: 4px solid #dc3545;
        padding-left: 0.5rem;
    }
</style>

<!-- ✅ JS logic -->
<script>
    // Show modal when clicking "+ New Task"
    var triggerBtn = document.querySelector('.btn.btn-sm.btn-primary');
    if (triggerBtn) {
        triggerBtn.addEventListener('click', () => {
            var modal = new bootstrap.Modal(document.getElementById('newTaskModal'));
            modal.show();
        });
    }

    // Handle Save click
    document.getElementById('saveTaskBtn').addEventListener('click', () => {
        var modalEl = document.getElementById('newTaskModal');
        var modal = bootstrap.Modal.getInstance(modalEl) || new bootstrap.Modal(modalEl);
        modal.hide();

        // Show alert
        var alertPlaceholder = document.createElement('div');
        alertPlaceholder.innerHTML = `
      <div class="alert alert-success alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3 shadow"
           role="alert" style="z-index: 2000; width: 300px;">
        Task created successfully.
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    `;
        document.body.appendChild(alertPlaceholder);

        setTimeout(() => {
            var alert = bootstrap.Alert.getOrCreateInstance(alertPlaceholder.querySelector('.alert'));
            alert.close();
        }, 2000);
    });
</script>